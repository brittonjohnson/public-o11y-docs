.. _otel-uninstall-integration:

********************************************
Uninstall the Collector
********************************************

.. meta::
      :description: Describes how to uninstall the Splunk Distribution of OpenTelemetry Collector.

Use the platform-specific information provided in this topic if you need to uninstall the Collector.

.. _otel-kubernetes-uninstall:

Uninstall on Kubernetes
==========================

Run the ``helm uninstall`` command to uninstall the Collector for Kubernetes. For example, to uninstall ``my-splunk-otel-collector``, run this command:

.. code-block:: bash

   helm uninstall my-splunk-otel-collector

Running this command does the following things:

* Removes all Kubernetes components associated with the chart
* Deletes the release
* Removes the release history

.. _otel-linux-uninstall-otel-and-tdagent:

Uninstall on Linux
================================================================

This section covers commands you can use to uninstall the Collector and Fluentd packages if you used the :ref:`installer script<linux-scripts>` or :ref:`Debian or RPM package <linux-packages>` to perform the installation.

If you installed the Collector and Fluentd using other methods; such as Ansible, Puppet, and Heroku as described in :ref:`otel-install-linux`; follow uninstall instructions specific to the tool you used.


.. _otel-linux-uninstall-details:

Understand which files are deleted by the uninstall
----------------------------------------------------------------

The uninstall commands covered here don't delete all of the files installed and created by the installer. Likewise, the uninstall commands don't delete all of the files generated by the Collector and Fluent services as they ran after installation. Typically, it's safe to just keep the files that aren't deleted by the uninstall.

While not an exhaustive list, here are key notes about some of the files that are or are not deleted when you use the installer script or a package manager command to perform the uninstall:

* The ``/tmp/splunk-otel-collector.sh`` installer script isn't deleted. You can delete the script if you don't need to run it again.

* The ``/etc/otel/collector/splunk-otel-collector.conf`` file isn't deleted. If you modified ``/etc/otel/collector/splunk-otel-collector.conf`` and want to keep the information in the file, be sure to back it up before re-running the installer script. The installer script recreates ``/etc/otel/collector/splunk-otel-collector.conf`` each time you run it, overwriting any existing ``/etc/otel/collector/splunk-otel-collector.conf``.

* On Debian-based systems, the following files are deleted. If you want to keep these files, be sure to back up the individual files or the entire ``/etc/otel/collector`` directory before you perform the uninstall. Files not in this list aren't deleted.

  * ``/etc/otel/collector/agent_config.yaml``
  * ``/etc/otel/collector/fluentd/README``
  * ``/etc/otel/collector/fluentd/conf.d/apache.conf``
  * ``/etc/otel/collector/fluentd/conf.d/cassandra.conf``
  * ``/etc/otel/collector/fluentd/conf.d/docker.conf``
  * ``/etc/otel/collector/fluentd/conf.d/etcd.conf``
  * ``/etc/otel/collector/fluentd/conf.d/jetty.conf``
  * ``/etc/otel/collector/fluentd/conf.d/journald.conf``
  * ``/etc/otel/collector/fluentd/conf.d/memcached.conf``
  * ``/etc/otel/collector/fluentd/conf.d/mongodb.conf``
  * ``/etc/otel/collector/fluentd/conf.d/mysql.conf``
  * ``/etc/otel/collector/fluentd/conf.d/nginx.conf``
  * ``/etc/otel/collector/fluentd/conf.d/postgresql.conf``
  * ``/etc/otel/collector/fluentd/conf.d/rabbitmq.conf``
  * ``/etc/otel/collector/fluentd/conf.d/redis.conf``
  * ``/etc/otel/collector/fluentd/conf.d/syslog.conf``
  * ``/etc/otel/collector/fluentd/conf.d/tomcat.conf``
  * ``/etc/otel/collector/fluentd/conf.d/zookeeper.conf``
  * ``/etc/otel/collector/fluentd/fluent.conf``
  * ``/etc/otel/collector/fluentd/splunk-otel-collector.conf``
  * ``/etc/otel/collector/gateway_config.yaml``
  * ``/etc/otel/collector/splunk-otel-collector.conf.example``
  * ``/etc/otel/collector/splunk-support-bundle.sh``

* On RPM-based systems, if you modified any of the following files, the modified files aren't deleted and are renamed with the .rpmsave extension. For example, the uninstall process renames a modified agent_config.yaml to agent_config.yaml.rpmsave. You can delete these .rpmsave files if you don't need them. Unmodified files in this list are deleted. Files not in this list aren't deleted.

  * ``/etc/otel/collector/agent_config.yaml``
  * ``/etc/otel/collector/fluentd/README``
  * ``/etc/otel/collector/fluentd/conf.d/apache.conf``
  * ``/etc/otel/collector/fluentd/conf.d/cassandra.conf``
  * ``/etc/otel/collector/fluentd/conf.d/docker.conf``
  * ``/etc/otel/collector/fluentd/conf.d/etcd.conf``
  * ``/etc/otel/collector/fluentd/conf.d/jetty.conf``
  * ``/etc/otel/collector/fluentd/conf.d/journald.conf``
  * ``/etc/otel/collector/fluentd/conf.d/memcached.conf``
  * ``/etc/otel/collector/fluentd/conf.d/mongodb.conf``
  * ``/etc/otel/collector/fluentd/conf.d/mysql.conf``
  * ``/etc/otel/collector/fluentd/conf.d/nginx.conf``
  * ``/etc/otel/collector/fluentd/conf.d/postgresql.conf``
  * ``/etc/otel/collector/fluentd/conf.d/rabbitmq.conf``
  * ``/etc/otel/collector/fluentd/conf.d/redis.conf``
  * ``/etc/otel/collector/fluentd/conf.d/syslog.conf``
  * ``/etc/otel/collector/fluentd/conf.d/tomcat.conf``
  * ``/etc/otel/collector/fluentd/conf.d/zookeeper.conf``
  * ``/etc/otel/collector/fluentd/fluent.conf``
  * ``/etc/otel/collector/fluentd/splunk-otel-collector.conf``
  * ``/etc/otel/collector/gateway_config.yaml``
  * ``/etc/otel/collector/splunk-otel-collector.conf.example``
  * ``/etc/otel/collector/splunk-support-bundle.sh``

* For information about some of the other files that can't be removed by the uninstall commands, see messages in your command-line interface after you run an uninstall command.


.. _otel-linux-uninstall-both-otel-and-tdagent:

Uninstall the Collector and Fluentd on Linux
-------------------------------------------------------------------------

.. note:: Before you perform the uninstall, be sure to understand its impact. See :ref:`otel-linux-uninstall-details`.

If you installed the Collector and Fluentd using the :ref:`installer script<linux-scripts>` or :ref:`Debian or RPM package <linux-packages>`, you can uninstall both of these packages by running the following command:

.. code-block:: bash

   curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh > /tmp/splunk-otel-collector.sh;
   sudo sh /tmp/splunk-otel-collector.sh --uninstall

Note that this snippet includes a command that downloads the latest ``splunk-otel-collector.sh`` installer script before performing the uninstall. We include this command because:

* If you used the Debian or RPM package to do the install, you might not have the installer script and need to download it to use this uninstall command.

* If you used the installer script to perform the install, you might not have the latest installer script downloaded.

To verify the uninstall, see :ref:`otel-linux-verify-uninstall`.

If you don't want to uninstall :strong:`both` packages and just want to uninstall the Collector package :strong:`or` Fluentd package, see :ref:`otel-linux-uninstall-only-otel-or-tdagent`.


.. _otel-linux-uninstall-only-otel-or-tdagent:

Uninstall only the Collector or Fluentd on Linux
--------------------------------------------------------------------

The uninstall command described in :ref:`otel-linux-uninstall-otel-and-tdagent` uninstalls :strong:`both` the Collector and Fluentd packages.

If you want to uninstall only the Collector package :strong:`or` the Fluentd package, use the following command for your platform.


For Debian
^^^^^^^^^^^^^^^

.. note:: Before performing an uninstall, see :ref:`otel-linux-uninstall-details`.

* To uninstall the Collector package only, run the following command:

  .. code-block:: bash

     sudo apt-get purge splunk-otel-collector

* To uninstall the Fluentd package only, run the following command:

  .. code-block:: bash

     sudo apt-get purge td-agent


For RPM
^^^^^^^^^^^^^^^

.. note:: Before performing an uninstall, see :ref:`otel-linux-uninstall-details`.

* To uninstall the Collector package only, run the command for the package manager on your system:

  .. code-block:: bash

     sudo yum remove splunk-otel-collector

  or

  .. code-block:: bash

     sudo dnf remove splunk-otel-collector

  or

  .. code-block:: bash

     sudo zypper remove splunk-otel-collector

* To uninstall the Fluentd package only, run the command for the package manager on your system:

  .. code-block:: bash

     sudo yum remove td-agent

  or

  .. code-block:: bash

     sudo dnf remove td-agent

  or

  .. code-block:: bash

     sudo zypper remove td-agent

To verify the uninstall, see :ref:`otel-linux-verify-uninstall`.


.. _otel-linux-verify-uninstall:

Verify the uninstall of the Collector and Fluentd on Linux
--------------------------------------------------------------------------------------------

While you can verify the uninstall of the Collector and Fluentd packages by watching for success messages in your command-line interface after running an uninstall command, you can also verify the uninstall by running a command that checks on the status of the Collector and Fluentd services. If the package has been successfully uninstalled, the status reflects this.

* To verify the uninstall of the Collector package, run this command:

  .. code-block:: bash

     sudo systemctl status splunk-otel-collector

  The expected result is ``Unit splunk-otel-collector.service could not be found.``

* To verify the uninstall of the Fluentd (td-agent) package, run this command:

  .. code-block:: bash

     sudo systemctl status td-agent

  The expected result is ``Unit td-agent.service could not be found.``

.. _otel-windows-uninstall:

Uninstall on Windows
=======================

.. _otel-windows-uninstall-panel:

Uninstall using the Windows Control Panel
--------------------------------------------------------------------------------------------

If installed with the installer script, the Collector and td-agent (Fluentd) can be uninstalled from **Programs and Features** in the Windows Control Panel. The configuration files might persist in ``\ProgramData\Splunk\OpenTelemetry Collector`` and ``\opt\td-agent`` after uninstall.

.. _otel-windows-uninstall-powershell:

Uninstall using PowerShell
--------------------------------------------------------------------------------------------

You can also uninstall the Collector for Windows using PowerShell:

.. code-block:: PowerShell

   # list installed programs to see if the Splunk OpenTelemetry Collector is installed
   Get-WmiObject -Class Win32_Product | Select-Object -Property Name 

   # if it exists, select the Collector 
   $MyProgram = Get-WmiObject -Class Win32_Product | Where-Object{$_.Name -eq "Splunk OpenTelemetry Collector"}  
   
   # complete uninstall 
   $MyProgram.uninstall()

Alternatively, try the following commands:  

.. code-block:: PowerShell

   return (Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\uninstall\* | Where { $_.DisplayName -eq "Splunk OpenTelemetry Collector" })
   
   $MyProgram.uninstall()